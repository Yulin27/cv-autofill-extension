<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PDF Extraction Test</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      border-radius: 8px;
      padding: 30px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      margin-bottom: 10px;
    }
    .subtitle {
      color: #666;
      margin-bottom: 30px;
    }
    .test-section {
      margin-bottom: 30px;
      padding: 20px;
      border: 1px solid #e0e0e0;
      border-radius: 4px;
      background: #fafafa;
    }
    .test-section h2 {
      margin-top: 0;
      color: #333;
      font-size: 18px;
    }
    button {
      background: #10b981;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: background 0.2s;
    }
    button:hover {
      background: #059669;
    }
    button:disabled {
      background: #9ca3af;
      cursor: not-allowed;
    }
    .file-input {
      margin: 15px 0;
    }
    input[type="file"] {
      padding: 8px;
      border: 1px solid #d1d5db;
      border-radius: 4px;
    }
    .status {
      margin-top: 15px;
      padding: 12px;
      border-radius: 4px;
      font-size: 14px;
    }
    .status.loading {
      background: #dbeafe;
      color: #1e40af;
      border: 1px solid #93c5fd;
    }
    .status.success {
      background: #d1fae5;
      color: #065f46;
      border: 1px solid #6ee7b7;
    }
    .status.error {
      background: #fee2e2;
      color: #991b1b;
      border: 1px solid #fca5a5;
    }
    .output {
      margin-top: 15px;
      padding: 15px;
      background: white;
      border: 1px solid #e0e0e0;
      border-radius: 4px;
      max-height: 400px;
      overflow-y: auto;
    }
    .output pre {
      margin: 0;
      white-space: pre-wrap;
      word-wrap: break-word;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      line-height: 1.5;
    }
    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }
    .stat-card {
      padding: 15px;
      background: white;
      border: 1px solid #e0e0e0;
      border-radius: 4px;
    }
    .stat-card .label {
      font-size: 12px;
      color: #666;
      margin-bottom: 5px;
    }
    .stat-card .value {
      font-size: 24px;
      font-weight: 600;
      color: #333;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>PDF Extraction Test</h1>
    <p class="subtitle">Test PDF.js integration for CV parsing</p>

    <!-- Test 1: Load PDF.js -->
    <div class="test-section">
      <h2>Test 1: Load PDF.js Library</h2>
      <button id="loadLibBtn">Load PDF.js</button>
      <div id="loadLibStatus"></div>
    </div>

    <!-- Test 2: Extract from test file -->
    <div class="test-section">
      <h2>Test 2: Extract Text from Test CV</h2>
      <p>Testing with: test/test_data/Yulin-SHI-CV.pdf</p>
      <button id="extractTestBtn">Extract Test CV</button>
      <div id="extractTestStatus"></div>
      <div id="extractTestStats" class="stats"></div>
      <div id="extractTestOutput" class="output" style="display:none;"></div>
    </div>

    <!-- Test 3: Upload custom PDF -->
    <div class="test-section">
      <h2>Test 3: Upload Custom PDF</h2>
      <div class="file-input">
        <input type="file" id="pdfFileInput" accept=".pdf">
      </div>
      <button id="extractCustomBtn">Extract Text</button>
      <div id="extractCustomStatus"></div>
      <div id="extractCustomStats" class="stats"></div>
      <div id="extractCustomOutput" class="output" style="display:none;"></div>
    </div>
  </div>

  <script type="module">
    // Load the PDF parser module
    import { extractTextFromPDF } from '../utils/pdf-parser.js';

    // Test 1: Load PDF.js
    document.getElementById('loadLibBtn').addEventListener('click', async () => {
      const statusDiv = document.getElementById('loadLibStatus');
      statusDiv.innerHTML = '<div class="status loading">Loading PDF.js library...</div>';

      try {
        // Load the library by trying to extract from a small test
        const testPdf = new Uint8Array([37, 80, 68, 70]); // Just PDF header
        try {
          await extractTextFromPDF(testPdf.buffer);
        } catch (e) {
          // Expected to fail with invalid PDF, but library should load
        }

        statusDiv.innerHTML = '<div class="status success">PDF.js library loaded successfully!</div>';
      } catch (error) {
        statusDiv.innerHTML = `<div class="status error">Error: ${error.message}</div>`;
      }
    });

    // Test 2: Extract from test file
    document.getElementById('extractTestBtn').addEventListener('click', async () => {
      const statusDiv = document.getElementById('extractTestStatus');
      const statsDiv = document.getElementById('extractTestStats');
      const outputDiv = document.getElementById('extractTestOutput');

      statusDiv.innerHTML = '<div class="status loading">Loading test PDF...</div>';
      statsDiv.innerHTML = '';
      outputDiv.style.display = 'none';

      try {
        const startTime = Date.now();

        // Fetch the test PDF
        const response = await fetch('../test/test_data/Yulin-SHI-CV.pdf');
        if (!response.ok) {
          throw new Error('Failed to load test PDF file');
        }

        const arrayBuffer = await response.arrayBuffer();
        statusDiv.innerHTML = '<div class="status loading">Extracting text from PDF...</div>';

        // Extract text
        const text = await extractTextFromPDF(arrayBuffer);
        const duration = ((Date.now() - startTime) / 1000).toFixed(2);

        // Show stats
        statsDiv.innerHTML = `
          <div class="stat-card">
            <div class="label">Characters</div>
            <div class="value">${text.length.toLocaleString()}</div>
          </div>
          <div class="stat-card">
            <div class="label">Words (approx)</div>
            <div class="value">${text.split(/\s+/).length.toLocaleString()}</div>
          </div>
          <div class="stat-card">
            <div class="label">Duration</div>
            <div class="value">${duration}s</div>
          </div>
        `;

        // Show output
        outputDiv.innerHTML = `<pre>${text}</pre>`;
        outputDiv.style.display = 'block';

        statusDiv.innerHTML = '<div class="status success">Text extracted successfully!</div>';
      } catch (error) {
        statusDiv.innerHTML = `<div class="status error">Error: ${error.message}</div>`;
        console.error('Extraction error:', error);
      }
    });

    // Test 3: Extract from custom file
    document.getElementById('extractCustomBtn').addEventListener('click', async () => {
      const fileInput = document.getElementById('pdfFileInput');
      const statusDiv = document.getElementById('extractCustomStatus');
      const statsDiv = document.getElementById('extractCustomStats');
      const outputDiv = document.getElementById('extractCustomOutput');

      if (!fileInput.files || !fileInput.files[0]) {
        statusDiv.innerHTML = '<div class="status error">Please select a PDF file first</div>';
        return;
      }

      statusDiv.innerHTML = '<div class="status loading">Reading PDF file...</div>';
      statsDiv.innerHTML = '';
      outputDiv.style.display = 'none';

      try {
        const startTime = Date.now();
        const file = fileInput.files[0];

        // Validate file type
        if (file.type !== 'application/pdf') {
          throw new Error('Please select a valid PDF file');
        }

        // Read file as ArrayBuffer
        const arrayBuffer = await file.arrayBuffer();
        statusDiv.innerHTML = '<div class="status loading">Extracting text from PDF...</div>';

        // Extract text
        const text = await extractTextFromPDF(arrayBuffer);
        const duration = ((Date.now() - startTime) / 1000).toFixed(2);

        // Show stats
        statsDiv.innerHTML = `
          <div class="stat-card">
            <div class="label">File Size</div>
            <div class="value">${(file.size / 1024).toFixed(1)} KB</div>
          </div>
          <div class="stat-card">
            <div class="label">Characters</div>
            <div class="value">${text.length.toLocaleString()}</div>
          </div>
          <div class="stat-card">
            <div class="label">Words (approx)</div>
            <div class="value">${text.split(/\s+/).length.toLocaleString()}</div>
          </div>
          <div class="stat-card">
            <div class="label">Duration</div>
            <div class="value">${duration}s</div>
          </div>
        `;

        // Show output
        outputDiv.innerHTML = `<pre>${text}</pre>`;
        outputDiv.style.display = 'block';

        statusDiv.innerHTML = '<div class="status success">Text extracted successfully!</div>';
      } catch (error) {
        statusDiv.innerHTML = `<div class="status error">Error: ${error.message}</div>`;
        console.error('Extraction error:', error);
      }
    });
  </script>
</body>
</html>
